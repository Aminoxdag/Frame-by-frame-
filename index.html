<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Video Frame Studio</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f0f;
            color: #e5e5e5;
            overscroll-behavior-y: contain;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        
        /* Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            margin-top: -6px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb {
            transform: scale(1.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #333;
            border-radius: 2px;
        }
        
        /* Number Input Styling (Remove arrows) */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        #fileInput { display: none; }

        .icon-btn {
            @apply p-2 rounded-full hover:bg-white/10 active:bg-white/20 transition-all duration-200 flex items-center justify-center select-none;
        }
        
        .frame-btn {
            @apply flex-1 bg-gray-800 active:bg-gray-700 text-white py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-all active:scale-95 border border-gray-700 shadow-sm;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-black text-gray-100">

    <!-- Header -->
    <header class="border-b border-gray-800 bg-[#121212] flex flex-col md:flex-row md:items-center justify-between p-3 shrink-0 z-20 gap-3">
        <div class="flex items-center justify-between w-full md:w-auto">
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                <h1 class="text-lg font-bold tracking-wide text-white">Frame Studio</h1>
            </div>
            <button onclick="document.getElementById('fileInput').click()" class="md:hidden bg-gray-800 text-white text-xs font-medium px-3 py-2 rounded-lg flex items-center gap-2 border border-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                Upload
            </button>
        </div>
        
        <div class="flex items-center gap-2 md:gap-4 w-full md:w-auto">
            <div class="flex flex-1 bg-[#1a1a1a] border border-gray-700 rounded-lg overflow-hidden focus-within:border-blue-500 transition-colors">
                <input type="text" id="urlInputHeader" placeholder="Paste Link..." class="bg-transparent border-none outline-none text-sm px-3 py-2 w-full text-gray-300 placeholder-gray-500 min-w-[100px]">
                <button onclick="loadFromUrl('urlInputHeader')" class="bg-gray-800 active:bg-gray-700 text-gray-300 px-3 py-2 border-l border-gray-700">Go</button>
            </div>
            <button onclick="document.getElementById('fileInput').click()" class="hidden md:flex bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-4 py-2 rounded-lg transition-colors items-center gap-2 shadow-lg">
                Upload File
            </button>
            <input type="file" id="fileInput" accept="video/*" onchange="loadFromFile(this.files[0])">
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 relative flex flex-col items-center justify-center bg-[#050505] overflow-hidden w-full" id="dropZone">
        
        <!-- Drag Overlay -->
        <div id="dragOverlay" class="absolute inset-0 bg-blue-500/20 border-4 border-dashed border-blue-500 z-50 hidden flex flex-col items-center justify-center backdrop-blur-sm">
            <p class="text-2xl font-bold text-white">Drop video here</p>
        </div>

        <!-- Placeholder State -->
        <div id="placeholder" class="text-center p-4 max-w-md w-full flex flex-col items-center">
            <div class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-6 text-gray-500 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            </div>
            <h2 class="text-xl md:text-2xl font-bold text-white mb-2">Load Video</h2>
            <p class="text-gray-400 mb-6 text-sm">Upload a file or paste a link to begin.</p>
            <div class="w-full flex flex-col gap-3">
                <div class="flex bg-[#1a1a1a] border border-gray-700 rounded-lg overflow-hidden focus-within:border-blue-500 transition-colors w-full shadow-lg">
                    <input type="text" id="urlInputMain" placeholder="Paste video URL here..." class="bg-transparent border-none outline-none text-base px-4 py-3 w-full text-gray-300 placeholder-gray-500">
                    <button onclick="loadFromUrl('urlInputMain')" class="bg-blue-600 active:bg-blue-700 text-white px-4 font-medium">Load</button>
                </div>
                <div class="relative w-full text-center border-t border-gray-800 my-2">
                    <span class="bg-[#050505] px-2 text-xs text-gray-500 relative -top-2.5">OR</span>
                </div>
                <button onclick="document.getElementById('fileInput').click()" class="bg-gray-800 active:bg-gray-700 text-white py-3 px-6 rounded-lg transition-all w-full border border-gray-700 font-medium hover:border-gray-600">
                    Select Local File
                </button>
            </div>
        </div>

        <!-- Video Stage -->
        <div id="videoStage" class="hidden relative w-full h-full flex flex-col">
            <!-- Video Container -->
            <div class="flex-1 flex items-center justify-center bg-black relative overflow-hidden group w-full">
                <video id="videoElement" class="w-full h-full object-contain" crossorigin="anonymous" playsinline></video>
                <div id="loadingSpinner" class="hidden absolute inset-0 flex items-center justify-center bg-black/50 z-20">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
                </div>
            </div>

            <!-- Enhanced Controls Panel (Scrollable if needed on very small screens) -->
            <div class="bg-[#121212] border-t border-gray-800 px-4 py-4 shrink-0 select-none flex flex-col gap-4 overflow-y-auto max-h-[50vh]">
                
                <!-- Row 1: Timeline -->
                <div class="flex items-center gap-3 w-full">
                    <span id="currentTime" class="text-xs text-blue-400 font-mono w-10 text-right">0:00</span>
                    <div class="relative flex-1 h-6 flex items-center group/scrubber">
                        <input type="range" id="progressBar" min="0" max="100" value="0" step="0.01" class="w-full z-10 opacity-0 absolute h-full cursor-pointer">
                        <div class="w-full h-1.5 bg-gray-700 rounded-full overflow-hidden pointer-events-none">
                            <div id="progressFill" class="h-full bg-blue-500 w-0"></div>
                        </div>
                    </div>
                    <span id="duration" class="text-xs text-gray-500 font-mono w-10">0:00</span>
                </div>

                <!-- Row 2: Transport (10s Skips + Play) -->
                <div class="flex items-center justify-center gap-6">
                    <!-- -10s -->
                    <button onclick="skipTime(-10)" class="icon-btn text-gray-400 hover:text-white flex flex-col gap-0.5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z" />
                        </svg>
                        <span class="text-[10px] font-bold">-10s</span>
                    </button>

                    <!-- Play/Pause -->
                    <button id="playBtn" onclick="togglePlay()" class="bg-white text-black rounded-full w-14 h-14 flex items-center justify-center shadow-lg active:scale-95 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 fill-current ml-0.5" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </button>

                    <!-- +10s -->
                    <button onclick="skipTime(10)" class="icon-btn text-gray-400 hover:text-white flex flex-col gap-0.5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
                        </svg>
                        <span class="text-[10px] font-bold">+10s</span>
                    </button>
                </div>

                <!-- Row 3: Frame Controls (Big Buttons + Step Input) -->
                <div class="bg-[#1a1a1a] p-2 rounded-xl flex items-center justify-between gap-3 shadow-inner border border-gray-800">
                    
                    <button onclick="stepFrame(-1)" class="frame-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Frame
                    </button>

                    <!-- Step Size Input -->
                    <div class="flex flex-col items-center justify-center px-1">
                        <label class="text-[9px] text-gray-500 uppercase tracking-wider font-bold mb-1">Step</label>
                        <input type="number" id="frameStep" value="1" min="1" max="60" class="bg-black text-blue-400 text-center text-lg font-bold w-12 py-1 rounded border border-gray-700 focus:border-blue-500 outline-none">
                    </div>

                    <button onclick="stepFrame(1)" class="frame-btn">
                        Frame
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- Row 4: Actions (Save & Fullscreen) -->
                <div class="flex items-center justify-between mt-1">
                    <button onclick="toggleFullscreen()" class="icon-btn text-gray-400 hover:text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                        </svg>
                    </button>

                    <button onclick="saveFrame()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-full font-bold shadow-lg shadow-blue-900/30 flex items-center gap-2 transition-transform active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Save PNG
                    </button>

                    <!-- Spacer for balance -->
                    <div class="w-8"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Canvas -->
    <canvas id="canvas" class="hidden"></canvas>

    <!-- Toast -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-900/95 backdrop-blur border border-gray-700 text-white px-6 py-3 rounded-2xl shadow-2xl transition-all duration-300 -translate-y-40 opacity-0 z-50 flex items-center gap-3 min-w-[200px] justify-center">
        <div id="toastIcon"></div>
        <span id="toastMessage" class="font-medium">Notification</span>
    </div>

    <script>
        const video = document.getElementById('videoElement');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const canvas = document.getElementById('canvas');
        const placeholder = document.getElementById('placeholder');
        const videoStage = document.getElementById('videoStage');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const dropZone = document.getElementById('dropZone');
        const dragOverlay = document.getElementById('dragOverlay');
        const playBtnIcon = document.querySelector('#playBtn svg path');
        const frameStepInput = document.getElementById('frameStep');
        
        let isDragActive = false;
        const FPS = 30; // Assuming 30fps for calculation
        let toastTimeout;

        // UI Logic
        function showVideoUI() {
            placeholder.style.display = 'none';
            videoStage.style.display = 'flex';
        }

        function loadFromUrl(inputId) {
            const url = document.getElementById(inputId).value.trim();
            if (!url) return;
            showLoading(true);
            video.crossOrigin = "anonymous";
            video.src = url;
            showVideoUI();
        }

        function loadFromFile(file) {
            if (!file) return;
            showLoading(true);
            const fileURL = URL.createObjectURL(file);
            if (video.src && video.src.startsWith('blob:')) URL.revokeObjectURL(video.src);
            video.removeAttribute('crossorigin');
            video.src = fileURL;
            showVideoUI();
        }

        // Video Events
        video.addEventListener('loadeddata', () => {
            showLoading(false);
            updateDuration();
            showToast("Video Loaded", "success");
        });

        video.addEventListener('error', () => {
            showLoading(false);
            showToast("Error loading video", "error");
        });

        video.addEventListener('timeupdate', () => {
            if (!Number.isFinite(video.duration)) return;
            const percent = (video.currentTime / video.duration) * 100;
            progressBar.value = percent;
            progressFill.style.width = `${percent}%`;
            document.getElementById('currentTime').innerText = formatTime(video.currentTime);
        });

        video.addEventListener('play', updatePlayBtn);
        video.addEventListener('pause', updatePlayBtn);

        // Control Logic
        function togglePlay() {
            if (video.paused) video.play();
            else video.pause();
        }

        function updatePlayBtn() {
            if (video.paused) {
                // Play Triangle
                playBtnIcon.setAttribute('d', 'M8 5v14l11-7z'); 
            } else {
                // Pause Bars
                playBtnIcon.setAttribute('d', 'M6 4h4v16H6V4zm8 0h4v16h-4V4z');
            }
        }

        function skipTime(seconds) {
            video.currentTime += seconds;
        }

        function stepFrame(direction) {
            if (!video.paused) video.pause();
            
            // Get step multiplier from input
            let multiplier = parseInt(frameStepInput.value);
            if (isNaN(multiplier) || multiplier < 1) multiplier = 1;

            const timeChange = (direction * multiplier) * (1 / FPS);
            video.currentTime += timeChange;
        }

        progressBar.addEventListener('input', (e) => {
            const time = (e.target.value / 100) * video.duration;
            video.currentTime = time;
        });

        // Save Logic
        function saveFrame() {
            if (!video.videoWidth) {
                showToast("No video loaded", "error");
                return;
            }

            try {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                link.download = `frame-${timestamp}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast("Frame Saved", "success");
            } catch (err) {
                if (err.name === 'SecurityError') {
                    showToast("Security Error (CORS)", "error");
                    alert("Cannot save frame from remote URL due to browser security. Please download the video and use 'Upload File'.");
                } else {
                    showToast("Save Failed", "error");
                }
            }
        }

        // Drag & Drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault(); e.stopPropagation();
            }, false);
        });
        dropZone.addEventListener('dragenter', () => { isDragActive = true; dragOverlay.classList.remove('hidden'); });
        dragOverlay.addEventListener('dragleave', () => { isDragActive = false; dragOverlay.classList.add('hidden'); });
        dropZone.addEventListener('drop', (e) => {
            isDragActive = false;
            dragOverlay.classList.add('hidden');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('video/')) loadFromFile(files[0]);
        });

        // Paste
        document.addEventListener('paste', (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (let index in items) {
                if (items[index].kind === 'file' && items[index].type.startsWith('video/')) {
                    loadFromFile(items[index].getAsFile());
                    return;
                }
            }
            const pastedText = (event.clipboardData || window.clipboardData).getData('text');
            if (pastedText && (pastedText.startsWith('http') || pastedText.startsWith('blob:'))) {
                document.getElementById('urlInputHeader').value = pastedText;
                document.getElementById('urlInputMain').value = pastedText;
                loadFromUrl('urlInputMain');
            }
        });

        // Helpers
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
        function updateDuration() {
            document.getElementById('duration').innerText = formatTime(video.duration);
        }
        function showLoading(show) {
            loadingSpinner.style.display = show ? 'flex' : 'none';
        }
        function toggleFullscreen() {
            const el = videoStage.querySelector('div');
            if (!document.fullscreenElement) el.requestFullscreen?.();
            else document.exitFullscreen?.();
        }
        function showToast(msg, type = 'neutral') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            const iconEl = document.getElementById('toastIcon');
            messageEl.innerText = msg;
            if (type === 'success') iconEl.innerHTML = `<svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`;
            else if (type === 'error') iconEl.innerHTML = `<svg class="w-5 h-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`;
            else iconEl.innerHTML = '';
            toast.classList.remove('-translate-y-40', 'opacity-0');
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => { toast.classList.add('-translate-y-40', 'opacity-0'); }, 3000);
        }
    </script>
</body>
</html>
